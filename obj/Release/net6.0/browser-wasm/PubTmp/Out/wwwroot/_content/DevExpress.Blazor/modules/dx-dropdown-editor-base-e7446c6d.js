import{a as e}from"./_tslib-bfc426b4.js";import{i as n}from"./dx-ui-element-fa46d41b.js";import{P as t}from"./supportcaptureelement-e000b699.js";import{DxUIHandlersBridgeTagName as o}from"./dx-ui-handlers-bridge-4076ae57.js";import{D as i}from"./dx-dropdown-owner-d9db7d72.js";import{E as s}from"./eventhelper-450cce9f.js";import{s as r}from"./lit-element-42a89b46.js";import{e as d}from"./property-0899c55e.js";class l extends i{constructor(){super(),this.boundOnKeyDownHandler=this.onKeyDown.bind(this),this.boundOnFocusOutHandler=this.onFocusOut.bind(this),this.boundOnClickHandler=this.onClick.bind(this),this.isDropDownOpen=!1,this.dropDownButtonElement=null,this._inputElement=null,this._uiHandlersBridge=null}get inputElement(){return this._inputElement}get uiHandlersBridge(){return this._uiHandlersBridge}connectedCallback(){super.connectedCallback(),this.addEventListener("keydown",this.boundOnKeyDownHandler),this.addEventListener("focusout",this.boundOnFocusOutHandler),this.addEventListener("click",this.boundOnClickHandler)}disconnectedCallback(){this.removeEventListener("keydown",this.boundOnKeyDownHandler),this.removeEventListener("focusout",this.boundOnFocusOutHandler),this.removeEventListener("click",this.boundOnClickHandler),super.disconnectedCallback()}getInputElement(){return this.querySelector("input")}onSlotChanged(e){super.onSlotChanged(e),this.dropDownButtonElement=this.querySelector(".dxbs-editor-dropdown-button"),this._inputElement=this.getInputElement(),n(this.inputElement,(()=>["logicalParent"]))&&this.addLogicalChild(this.inputElement),this._uiHandlersBridge=this.querySelector(o)}onKeyDown(e){this.isDropDownOpen||this.invokeKeyDownServerCommand(e)}onDropDownShown(e){var n;super.onDropDownShown(e),this.useMobileFocusBehaviour||null===(n=this.inputElement)||void 0===n||n.focus()}onFocusOut(e){var n,t,o;const i=s.getEventSource(e);if(null===(n=this.dropDownElement)||void 0===n?void 0:n.contains(i))return;const r=null!==(t=e.relatedTarget)&&void 0!==t?t:document.activeElement;this.contains(r)||(null===(o=this.dropDownElement)||void 0===o?void 0:o.contains(r))||this.processLostFocus()}onClick(e){var n;if(!s.containsInComposedPath(e,l.isClearButtonElement))return s.containsInComposedPath(e,l.isDropDownButtonElement)?(e.stopPropagation(),void this.toggleDropDownVisibility()):void 0;null===(n=this.inputElement)||void 0===n||n.focus()}canHandlePointerDown(e){return t.containsInComposedPath(e,this.dropDownButtonElement)||t.containsInComposedPath(e,this.inputElement)}invokeKeyDownServerCommand(e){return l.isToggleDropDownVisibilityKeyCommand(e)?(this.toggleDropDownVisibility(),!0):super.invokeKeyDownServerCommand(e)}processLostFocus(){}ensureDropDownElement(){super.ensureDropDownElement(),this.dropDownElement&&this.dropDownElement.addEventListener("focusout",this.boundOnFocusOutHandler)}disposeDropDownElement(){super.disposeDropDownElement(),this.dropDownElement&&this.dropDownElement.removeEventListener("focusout",this.boundOnFocusOutHandler)}toggleDropDownVisibility(){var e;null===(e=this.uiHandlersBridge)||void 0===e||e.send(this.isDropDownOpen?"closeDropDown":"openDropDown",{})}static isToggleDropDownVisibilityKeyCommand(e){return(e.altKey||e.metaKey)&&("ArrowUp"===e.key||"ArrowDown"===e.key)}static isClearButtonElement(e){var n;return!!e&&(null===(n=e.classList)||void 0===n?void 0:n.contains("dxbs-editor-clear-btn"))}static isDropDownButtonElement(e){var n;return!!e&&(null===(n=e.classList)||void 0===n?void 0:n.contains("dxbs-editor-dropdown-button"))}}l.shadowRootOptions={...r.shadowRootOptions,delegatesFocus:!0},e([d({type:Boolean,attribute:"is-dropdown-open"})],l.prototype,"isDropDownOpen",void 0);export{l as D};
